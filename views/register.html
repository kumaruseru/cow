<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêƒÉng k√Ω - Cow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.7.7/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            position: relative;
            overflow: hidden; /* Th√™m thu·ªôc t√≠nh n√†y ƒë·ªÉ ·∫©n thanh cu·ªôn c·ªßa tr√¨nh duy·ªát */
        }

        /* --- N·ªÄN LAVA LAMP --- */
        #lava-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            filter: blur(30px) contrast(40);
            background: #f0f2f5;
        }

        .blob {
            position: absolute;
            background-color: #333;
            border-radius: 50%;
            top: 0;
            left: 0;
        }
        
        /* --- KEYFRAME ANIMATIONS --- */
        @keyframes fadeInScaleUp {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* --- √ÅP D·ª§NG ANIMATION V√Ä STYLE --- */
        .animate-fade-in-scale-up {
            animation: fadeInScaleUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        
        /* --- Hi·ªáu ·ª©ng Nh√£n N·ªïi (Floating Label) --- */
        .form-group {
            position: relative;
        }
        .form-input {
            border: 2px solid #e2e8f0;
            transition: border-color 0.2s, box-shadow 0.2s;
            /* H·ªó tr·ª£ IME v√† b√†n ph√≠m ti·∫øng Vi·ªát */
            ime-mode: disabled; /* T·∫Øt IME cho input s·ªë */
        }
        .form-input:focus, .form-input.focused {
            outline: none;
            border-color: #000;
            box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.1);
        }
        /* H·ªó tr·ª£ composition events cho IME */
        .form-input[inputmode="numeric"] {
            font-variant-numeric: tabular-nums;
            text-align: center;
        }
        /* Highlight khi ƒëang compose v·ªõi IME */
        .form-input.composing {
            background-color: #fef3c7;
            border-color: #f59e0b;
        }
        .form-label {
            position: absolute;
            top: 50%;
            left: 1rem;
            transform: translateY(-50%);
            color: #9ca3af;
            background-color: white;
            padding: 0 0.25rem;
            transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            pointer-events: none;
        }

        .form-input:focus + .form-label,
        .form-input:not(:placeholder-shown) + .form-label,
        .form-group.has-value .form-label,
        .form-group.focused .form-label {
            top: 0;
            transform: translateY(-50%) scale(0.85);
            color: #000;
            font-weight: 600;
        }
        
        /* --- Icon hi·ªÉn th·ªã m·∫≠t kh·∫©u --- */
        .password-toggle {
            position: absolute;
            top: 50%;
            right: 1rem;
            transform: translateY(-50%);
            cursor: pointer;
            color: #9ca3af;
        }
        .password-toggle:hover {
            color: #333;
        }

        /* --- T√ôY CH·ªàNH THANH CU·ªòN --- */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        /* ·∫®n thanh cu·ªôn */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    
    <!-- Container cho hi·ªáu ·ª©ng lava lamp -->
    <div id="lava-container"></div>

    <!-- Card ƒêƒÉng K√Ω Ch√≠nh v·ªõi hi·ªáu ·ª©ng -->
    <div class="w-full max-w-md p-8 lg:p-10 space-y-6 bg-white rounded-3xl shadow-2xl m-4 animate-fade-in-scale-up z-10 max-h-[90vh] overflow-y-auto no-scrollbar">
        
        <!-- Ph·∫ßn Header -->
        <div class="text-center">
            <h1 class="text-4xl font-extrabold text-gray-900">T·∫°o T√†i Kho·∫£n</h1>
            <p class="mt-2 text-base text-gray-600">Gia nh·∫≠p ƒë√†n b√≤ ngay h√¥m nay</p>
        </div>

        <!-- Form ƒêƒÉng K√Ω -->
        <form class="mt-8 space-y-6" id="register-form" method="POST" action="javascript:void(0);" onsubmit="return false;">
            <div class="space-y-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <input id="last-name" name="last-name" type="text" autocomplete="family-name" required class="form-input relative block w-full px-4 py-3.5 text-gray-900 rounded-lg appearance-none placeholder-transparent" placeholder="H·ªç">
                        <label for="last-name" class="form-label">H·ªç</label>
                    </div>
                    <div class="form-group">
                        <input id="first-name" name="first-name" type="text" autocomplete="given-name" required class="form-input relative block w-full px-4 py-3.5 text-gray-900 rounded-lg appearance-none placeholder-transparent" placeholder="T√™n">
                        <label for="first-name" class="form-label">T√™n</label>
                    </div>
                </div>
                <div class="form-group">
                    <input id="email-address" name="email" type="email" autocomplete="email" required class="form-input relative block w-full px-4 py-3.5 text-gray-900 rounded-lg appearance-none placeholder-transparent" placeholder="ƒê·ªãa ch·ªâ email">
                    <label for="email-address" class="form-label">ƒê·ªãa ch·ªâ email</label>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-500 mb-2 pl-1">Ng√†y sinh</label>
                    <div class="grid grid-cols-6 gap-2">
                        <!-- Day Input -->
                        <div class="form-group col-span-2">
                            <input id="birth-day" name="birth-day" type="text" maxlength="2" 
                                   inputmode="numeric" pattern="[0-9]*" autocomplete="bday-day"
                                   class="form-input relative block w-full px-4 py-3.5 text-gray-900 rounded-lg appearance-none placeholder-transparent" 
                                   placeholder="Ng√†y">
                            <label for="birth-day" class="form-label">Ng√†y</label>
                        </div>
                        <!-- Month Input -->
                        <div class="form-group col-span-2">
                            <input id="birth-month" name="birth-month" type="text" maxlength="2" 
                                   inputmode="numeric" pattern="[0-9]*" autocomplete="bday-month"
                                   class="form-input relative block w-full px-4 py-3.5 text-gray-900 rounded-lg appearance-none placeholder-transparent" 
                                   placeholder="Th√°ng">
                            <label for="birth-month" class="form-label">Th√°ng</label>
                        </div>
                        <!-- Year Input -->
                        <div class="form-group col-span-2">
                            <input id="birth-year" name="birth-year" type="text" maxlength="4" 
                                   inputmode="numeric" pattern="[0-9]*" autocomplete="bday-year"
                                   class="form-input relative block w-full px-4 py-3.5 text-gray-900 rounded-lg appearance-none placeholder-transparent" 
                                   placeholder="NƒÉm">
                            <label for="birth-year" class="form-label">NƒÉm</label>
                        </div>
                    </div>
                </div>
                 <div>
                    <label class="block text-sm font-medium text-gray-500 mb-2 pl-1">Gi·ªõi t√≠nh</label>
                    <div class="grid grid-cols-3 gap-2 rounded-lg p-1 bg-gray-100">
                        <div>
                            <input type="radio" name="gender" id="male" value="male" class="sr-only peer">
                            <label for="male" class="block w-full text-center py-2 px-2 rounded-md cursor-pointer text-sm font-semibold text-gray-600 peer-checked:bg-white peer-checked:text-black peer-checked:shadow transition">Nam</label>
                        </div>
                        <div>
                            <input type="radio" name="gender" id="female" value="female" class="sr-only peer">
                            <label for="female" class="block w-full text-center py-2 px-2 rounded-md cursor-pointer text-sm font-semibold text-gray-600 peer-checked:bg-white peer-checked:text-black peer-checked:shadow transition">N·ªØ</label>
                        </div>
                        <div>
                            <input type="radio" name="gender" id="other" value="other" class="sr-only peer">
                            <label for="other" class="block w-full text-center py-2 px-2 rounded-md cursor-pointer text-sm font-semibold text-gray-600 peer-checked:bg-white peer-checked:text-black peer-checked:shadow transition">Kh√°c</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <input id="password" name="password" type="password" autocomplete="new-password" required class="form-input relative block w-full px-4 py-3.5 text-gray-900 rounded-lg appearance-none placeholder-transparent" placeholder="M·∫≠t kh·∫©u">
                    <label for="password" class="form-label">M·∫≠t kh·∫©u</label>
                    <span class="password-toggle" id="password-toggle-icon">
                        <svg id="eye-open" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                        <svg id="eye-closed" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7 .946-3.11 3.563-5.523 6.813-6.163M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c1.47 0 2.87.347 4.125.975m2.828 2.828A6.975 6.975 0 0119 12c-1.274 4.057-5.064 7-9.542 7-1.354 0-2.646-.3-3.825-.833M17.75 17.75L6.25 6.25" /></svg>
                    </span>
                </div>
                 <div class="form-group">
                    <input id="confirm-password" name="confirm-password" type="password" autocomplete="new-password" required class="form-input relative block w-full px-4 py-3.5 text-gray-900 rounded-lg appearance-none placeholder-transparent" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u">
                    <label for="confirm-password" class="form-label">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                </div>
            </div>

            <div class="pt-2">
                <button type="submit" class="relative flex justify-center w-full px-4 py-3 text-base font-bold text-white bg-black border border-transparent rounded-lg group focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black transition-all duration-300 ease-in-out hover:bg-gray-800 hover:shadow-lg hover:-translate-y-1">
                    ƒêƒÉng K√Ω
                </button>
            </div>
        </form>
        
        <p class="pt-4 text-sm text-center text-gray-600">
            ƒê√£ l√† th√†nh vi√™n c·ªßa ƒë√†n?
            <a href="/login" class="font-semibold text-black hover:underline transition-colors duration-200 hover:text-gray-700">
                ƒêƒÉng nh·∫≠p ngay
            </a>
        </p>
    </div>

    <script>
        lucide.createIcons();

        window.onload = function() {
            // ƒê·ª£i m·ªôt ch√∫t ƒë·ªÉ c√°c th∆∞ vi·ªán t·∫£i xong
            setTimeout(() => {
                // Check if required libraries are loaded
                if (typeof axios === 'undefined') {
                    console.error('Axios is not loaded!');
                    // Th·ª≠ t·∫£i l·∫°i axios v·ªõi CDN kh√°c
                    const script = document.createElement('script');
                    script.src = 'https://unpkg.com/axios/dist/axios.min.js';
                    script.onload = () => {
                        console.log('Axios loaded successfully from fallback CDN');
                        initializeApp();
                    };
                    script.onerror = () => {
                        console.error('Failed to load axios from all CDNs');
                        // N·∫øu v·∫´n kh√¥ng t·∫£i ƒë∆∞·ª£c, s·ª≠ d·ª•ng fetch API thay th·∫ø
                        window.axios = {
                            post: async function(url, data) {
                                const response = await fetch(url, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify(data)
                                });
                                const result = await response.json();
                                if (!response.ok) {
                                    throw new Error(result.message || 'Request failed');
                                }
                                return {
                                    data: result,
                                    status: response.status,
                                    statusText: response.statusText
                                };
                            }
                        };
                        console.log('Using fetch API as axios fallback');
                        initializeApp();
                    };
                    document.head.appendChild(script);
                    return;
                }
                
                console.log('All libraries loaded successfully');
                initializeApp();
            }, 200);
        };

        function initializeApp() {
            console.log('üéØ initializeApp started');
            console.log('üîç Checking for form element...');
            
            // --- Logic t·∫°o hi·ªáu ·ª©ng lava lamp ---
            const lavaContainer = document.getElementById('lava-container');
            if (lavaContainer) {
                const containerRect = lavaContainer.getBoundingClientRect();
                const containerWidth = containerRect.width;
                const containerHeight = containerRect.height;
                const numberOfBlobs = 15;
                const style = document.createElement('style');
                document.head.appendChild(style);

                for (let i = 0; i < numberOfBlobs; i++) {
                    const blob = document.createElement('div');
                    blob.classList.add('blob');
                    const size = Math.random() * 250 + 100;
                    const duration = Math.random() * 20 + 15;
                    const delay = Math.random() * -15;
                    const colors = ['#2d2d2d', '#333', '#404040', '#4a4a4a', '#555'];
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    const x1 = Math.random() * (containerWidth - size);
                    const y1 = Math.random() * (containerHeight - size);
                    const x2 = Math.random() * (containerWidth - size);
                    const y2 = Math.random() * (containerHeight - size);
                    const animationName = `move-blob-${i}`;
                    style.sheet.insertRule(`
                        @keyframes ${animationName} {
                            0% { transform: translate(${x1}px, ${y1}px); }
                            50% { transform: translate(${x2}px, ${y2}px); }
                            100% { transform: translate(${x1}px, ${y1}px); }
                        }
                    `);
                    blob.style.width = `${size}px`;
                    blob.style.height = `${size}px`;
                    blob.style.backgroundColor = color;
                    blob.style.animation = `${animationName} ${duration}s ${delay}s linear infinite`;
                    lavaContainer.appendChild(blob);
                }
            }

            // --- Logic cho vi·ªác hi·ªÉn th·ªã/·∫©n m·∫≠t kh·∫©u ---
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('password-toggle-icon');
            const eyeOpen = document.getElementById('eye-open');
            const eyeClosed = document.getElementById('eye-closed');

            if (toggleIcon && passwordInput && eyeOpen && eyeClosed) {
                toggleIcon.addEventListener('click', function () {
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    eyeOpen.classList.toggle('hidden');
                    eyeClosed.classList.toggle('hidden');
                });
                console.log('üîë Password toggle functionality initialized');
            } else {
                console.warn('‚ö†Ô∏è Password toggle elements not found');
            }

            // --- Logic cho date input validation ---
            function setupDateInputValidation() {
                const dayInput = document.getElementById('birth-day');
                const monthInput = document.getElementById('birth-month');
                const yearInput = document.getElementById('birth-year');

                if (!dayInput || !monthInput || !yearInput) {
                    console.warn('‚ö†Ô∏è Date input elements not found');
                    return;
                }

                console.log('üìÖ Date validation setup started');

                if (!dayInput || !monthInput || !yearInput) {
                    console.error('Date input elements not found!');
                    return;
                }

                console.log('Date inputs found, setting up validation...');

                // Ch·ªâ cho ph√©p nh·∫≠p s·ªë v·ªõi smart auto-focus - H·ªó tr·ª£ IME v√† b√†n ph√≠m ti·∫øng Vi·ªát
                function allowOnlyNumbers(input) {
                    let isComposing = false;
                    let lastValidValue = '';

                    // Theo d√µi tr·∫°ng th√°i composing c·ªßa IME
                    input.addEventListener('compositionstart', function(e) {
                        isComposing = true;
                        lastValidValue = this.value;
                        this.classList.add('composing');
                    });

                    input.addEventListener('compositionend', function(e) {
                        isComposing = false;
                        this.classList.remove('composing');
                        // X·ª≠ l√Ω d·ªØ li·ªáu sau khi IME ho√†n th√†nh
                        setTimeout(() => {
                            this.value = this.value.replace(/[^0-9]/g, '');
                            // Trigger input event ƒë·ªÉ c√°c validation kh√°c ch·∫°y
                            this.dispatchEvent(new Event('input', { bubbles: true }));
                        }, 0);
                    });

                    input.addEventListener('input', function(e) {
                        // Kh√¥ng x·ª≠ l√Ω khi ƒëang trong qu√° tr√¨nh composing c·ªßa IME
                        if (isComposing) {
                            return;
                        }
                        
                        // Ch·ªâ gi·ªØ l·∫°i c√°c k√Ω t·ª± s·ªë
                        const newValue = this.value.replace(/[^0-9]/g, '');
                        if (this.value !== newValue) {
                            this.value = newValue;
                        }
                    });

                    // X·ª≠ l√Ω c√°c ph√≠m ƒë·∫∑c bi·ªát (kh√¥ng can thi·ªáp v√†o IME)
                    input.addEventListener('keydown', function(e) {
                        // Cho ph√©p c√°c ph√≠m ƒëi·ªÅu h∆∞·ªõng v√† ch·ªânh s·ª≠a
                        const allowedKeys = [
                            'Backspace', 'Delete', 'Tab', 'Enter', 'Escape',
                            'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',
                            'Home', 'End', 'PageUp', 'PageDown'
                        ];
                        
                        // Cho ph√©p Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                        if (e.ctrlKey && ['a', 'c', 'v', 'x'].includes(e.key.toLowerCase())) {
                            return;
                        }
                        
                        // N·∫øu ƒëang composing (IME ho·∫°t ƒë·ªông), kh√¥ng can thi·ªáp
                        if (isComposing) {
                            return;
                        }
                        
                        // X·ª≠ l√Ω ph√≠m Backspace ƒë·ªÉ quay l·∫°i field tr∆∞·ªõc
                        if (e.key === 'Backspace' && this.value === '' && this.selectionStart === 0) {
                            const id = this.id;
                            if (id === 'birth-month') {
                                e.preventDefault();
                                setTimeout(() => {
                                    const dayInput = document.getElementById('birth-day');
                                    if (dayInput) {
                                        dayInput.focus();
                                        dayInput.setSelectionRange(dayInput.value.length, dayInput.value.length);
                                    }
                                }, 10);
                            } else if (id === 'birth-year') {
                                e.preventDefault();
                                setTimeout(() => {
                                    const monthInput = document.getElementById('birth-month');
                                    if (monthInput) {
                                        monthInput.focus();
                                        monthInput.setSelectionRange(monthInput.value.length, monthInput.value.length);
                                    }
                                }, 10);
                            }
                        }
                        
                        // Ch·ªâ cho ph√©p s·ªë v√† c√°c ph√≠m ƒë·∫∑c bi·ªát
                        if (!allowedKeys.includes(e.key) && (e.key.length === 1 && !/[0-9]/.test(e.key))) {
                            // Kh√¥ng ch·∫∑n n·∫øu l√† ph√≠m t·ªï h·ª£p ho·∫∑c c√≥ th·ªÉ l√† IME
                            if (!e.altKey && !e.ctrlKey && !e.metaKey) {
                                e.preventDefault();
                            }
                        }
                    });

                    // X·ª≠ l√Ω paste ƒë·ªÉ ch·ªâ cho ph√©p s·ªë
                    input.addEventListener('paste', function(e) {
                        e.preventDefault();
                        const paste = (e.clipboardData || window.clipboardData).getData('text');
                        const numbersOnly = paste.replace(/[^0-9]/g, '');
                        if (numbersOnly) {
                            // Ch·ªâ l·∫•y s·ªë k√Ω t·ª± ph√π h·ª£p v·ªõi maxlength
                            const maxLength = parseInt(this.getAttribute('maxlength')) || numbersOnly.length;
                            this.value = numbersOnly.substring(0, maxLength);
                            // Trigger input event
                            this.dispatchEvent(new Event('input', { bubbles: true }));
                        }
                    });
                }

                // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
                function showFieldError(input, message) {
                    input.style.borderColor = '#ef4444';
                    input.style.boxShadow = '0 0 0 4px rgba(239, 68, 68, 0.1)';
                    input.style.backgroundColor = '#fef2f2';
                    input.setCustomValidity(message);
                    
                    // T·∫°o ho·∫∑c c·∫≠p nh·∫≠t th√¥ng b√°o l·ªói
                    let errorDiv = input.parentElement.querySelector('.error-message');
                    if (!errorDiv) {
                        errorDiv = document.createElement('div');
                        errorDiv.className = 'error-message text-xs text-red-500 mt-1 absolute left-0 top-full z-10';
                        input.parentElement.style.position = 'relative';
                        input.parentElement.appendChild(errorDiv);
                    }
                    errorDiv.textContent = message;
                    errorDiv.style.display = 'block';
                }

                // X√≥a th√¥ng b√°o l·ªói
                function clearFieldError(input) {
                    input.style.borderColor = '';
                    input.style.boxShadow = '';
                    input.style.backgroundColor = '';
                    input.setCustomValidity('');
                    
                    const errorDiv = input.parentElement.querySelector('.error-message');
                    if (errorDiv) {
                        errorDiv.style.display = 'none';
                    }
                }

                // Validation cho ng√†y (01-31, b·∫Øt bu·ªôc 2 ch·ªØ s·ªë v·ªõi logic th√°ng)
                function validateDay(input) {
                    function validate() {
                        const value = input.value.trim();
                        if (value === '') {
                            clearFieldError(input);
                            return;
                        }
                        
                        // Ki·ªÉm tra format 2 ch·ªØ s·ªë
                        if (value.length !== 2) {
                            showFieldError(input, 'Ng√†y ph·∫£i c√≥ 2 ch·ªØ s·ªë (01-31)');
                            return;
                        }
                        
                        const dayValue = parseInt(value);
                        if (isNaN(dayValue) || dayValue < 1 || dayValue > 31) {
                            showFieldError(input, 'Ng√†y ph·∫£i t·ª´ 01 ƒë·∫øn 31');
                            return;
                        }

                        // Ki·ªÉm tra v·ªõi th√°ng v√† nƒÉm n·∫øu c√≥
                        const monthInput = document.getElementById('birth-month');
                        const yearInput = document.getElementById('birth-year');
                        
                        if (monthInput.value.length === 2 && yearInput.value.length === 4) {
                            const month = parseInt(monthInput.value);
                            const year = parseInt(yearInput.value);
                            
                            if (!isNaN(month) && !isNaN(year) && month >= 1 && month <= 12) {
                                const maxDays = getMaxDaysInMonth(month, year);
                                if (dayValue > maxDays) {
                                    let errorMessage = '';
                                    if (month === 2) {
                                        const isLeapYear = isLeapYearFunction(year);
                                        errorMessage = isLeapYear 
                                            ? 'Th√°ng 2 nƒÉm nhu·∫≠n ch·ªâ c√≥ 29 ng√†y'
                                            : 'Th√°ng 2 ch·ªâ c√≥ 28 ng√†y';
                                    } else if ([4, 6, 9, 11].includes(month)) {
                                        errorMessage = `Th√°ng ${month.toString().padStart(2, '0')} ch·ªâ c√≥ 30 ng√†y`;
                                    } else {
                                        errorMessage = `Ng√†y kh√¥ng h·ª£p l·ªá trong th√°ng ${month.toString().padStart(2, '0')}`;
                                    }
                                    showFieldError(input, errorMessage);
                                    return;
                                }
                            }
                        }
                        
                        clearFieldError(input);
                        // Ki·ªÉm tra validation t·ªïng h·ª£p
                        setTimeout(validateFullDate, 100);
                    }
                    
                    input.addEventListener('input', function(e) {
                        // Delay ƒë·ªÉ ƒë·∫£m b·∫£o IME ho√†n th√†nh x·ª≠ l√Ω
                        setTimeout(() => {
                            const value = this.value;
                            
                            // Auto-format: n·∫øu nh·∫≠p 1 ch·ªØ s·ªë
                            if (value.length === 1) {
                                const num = parseInt(value);
                                // N·∫øu nh·∫≠p s·ªë >= 4, t·ª± ƒë·ªông th√™m 0 ph√≠a tr∆∞·ªõc v√† chuy·ªÉn field
                                if (num >= 4 && num <= 9) {
                                    this.value = '0' + value;
                                    setTimeout(() => {
                                        validate(); // Validate sau khi format
                                        const monthInput = document.getElementById('birth-month');
                                        if (monthInput && !input.parentElement.querySelector('.error-message:not([style*="display: none"])')) {
                                            monthInput.focus();
                                        }
                                    }, 50);
                                }
                                // N·∫øu nh·∫≠p 1, 2, 3 ho·∫∑c 0, ch·ªù nh·∫≠p ti·∫øp
                                else if (num >= 0 && num <= 3) {
                                    // Ch·ªù nh·∫≠p k√Ω t·ª± th·ª© 2
                                    return;
                                }
                                else {
                                    showFieldError(this, 'Ng√†y ph·∫£i t·ª´ 01 ƒë·∫øn 31');
                                }
                            }
                            // N·∫øu ƒë√£ nh·∫≠p ƒë·ªß 2 ch·ªØ s·ªë
                            else if (value.length === 2) {
                                validate();
                                
                                // N·∫øu valid, chuy·ªÉn sang th√°ng
                                const dayValue = parseInt(value);
                                if (dayValue >= 1 && dayValue <= 31) {
                                    setTimeout(() => {
                                        const monthInput = document.getElementById('birth-month');
                                        if (monthInput && !input.parentElement.querySelector('.error-message:not([style*="display: none"])')) {
                                            monthInput.focus();
                                        }
                                    }, 50);
                                }
                            }
                            else {
                                validate();
                            }
                        }, 10); // Delay ng·∫Øn ƒë·ªÉ IME ho√†n th√†nh
                    });
                    
                    // Khi blur, t·ª± ƒë·ªông th√™m 0 n·∫øu ch·ªâ c√≥ 1 ch·ªØ s·ªë v√† validate
                    input.addEventListener('blur', function() {
                        const value = this.value.trim();
                        if (value.length === 1) {
                            const num = parseInt(value);
                            if (num >= 1 && num <= 9) {
                                this.value = '0' + value;
                            }
                        }
                        validate();
                    });
                    
                    input.addEventListener('keyup', validate);
                }

                // Validation cho th√°ng (01-12, b·∫Øt bu·ªôc 2 ch·ªØ s·ªë)
                function validateMonth(input) {
                    function validate() {
                        const value = input.value.trim();
                        if (value === '') {
                            clearFieldError(input);
                            return;
                        }
                        
                        // Ki·ªÉm tra format 2 ch·ªØ s·ªë
                        if (value.length !== 2) {
                            showFieldError(input, 'Th√°ng ph·∫£i c√≥ 2 ch·ªØ s·ªë (01-12)');
                            return;
                        }
                        
                        const monthValue = parseInt(value);
                        if (isNaN(monthValue) || monthValue < 1 || monthValue > 12) {
                            showFieldError(input, 'Th√°ng ph·∫£i t·ª´ 01 ƒë·∫øn 12');
                        } else {
                            clearFieldError(input);
                            
                            // Re-validate ng√†y khi th√°ng thay ƒë·ªïi
                            const dayInput = document.getElementById('birth-day');
                            if (dayInput && dayInput.value.length === 2) {
                                setTimeout(() => {
                                    validateDay(dayInput);
                                    validateFullDate();
                                }, 50);
                            }
                            
                            // Ki·ªÉm tra validation t·ªïng h·ª£p
                            setTimeout(validateFullDate, 100);
                        }
                    }
                    
                    input.addEventListener('input', function(e) {
                        // Delay ƒë·ªÉ ƒë·∫£m b·∫£o IME ho√†n th√†nh x·ª≠ l√Ω
                        setTimeout(() => {
                            const value = this.value;
                            
                            // Auto-format: n·∫øu nh·∫≠p 1 ch·ªØ s·ªë v√† blur ho·∫∑c nh·∫≠p ti·∫øp
                            if (value.length === 1) {
                                const num = parseInt(value);
                                // N·∫øu nh·∫≠p s·ªë >= 2, t·ª± ƒë·ªông th√™m 0 ph√≠a tr∆∞·ªõc v√† chuy·ªÉn field
                                if (num >= 2 && num <= 9) {
                                    this.value = '0' + value;
                                    setTimeout(() => {
                                        validate(); // Validate sau khi format
                                        if (num <= 12) { // Ch·ªâ chuy·ªÉn field n·∫øu th√°ng h·ª£p l·ªá
                                            const yearInput = document.getElementById('birth-year');
                                            if (yearInput && !input.parentElement.querySelector('.error-message:not([style*="display: none"])')) {
                                                yearInput.focus();
                                            }
                                        }
                                    }, 50);
                                }
                                // N·∫øu nh·∫≠p 1 ho·∫∑c 0, ch·ªù nh·∫≠p ti·∫øp
                                else if (num >= 0 && num <= 1) {
                                    // Ch·ªù nh·∫≠p k√Ω t·ª± th·ª© 2
                                    return;
                                }
                                else {
                                    showFieldError(this, 'Th√°ng ph·∫£i t·ª´ 01 ƒë·∫øn 12');
                                }
                            }
                            // N·∫øu ƒë√£ nh·∫≠p ƒë·ªß 2 ch·ªØ s·ªë
                            else if (value.length === 2) {
                                validate();
                                
                                // N·∫øu valid, chuy·ªÉn sang nƒÉm
                                const monthValue = parseInt(value);
                                if (monthValue >= 1 && monthValue <= 12) {
                                    setTimeout(() => {
                                        const yearInput = document.getElementById('birth-year');
                                        if (yearInput && !input.parentElement.querySelector('.error-message:not([style*="display: none"])')) {
                                            yearInput.focus();
                                        }
                                    }, 50);
                                }
                            }
                            else {
                                validate();
                            }
                        }, 10); // Delay ng·∫Øn ƒë·ªÉ IME ho√†n th√†nh
                    });
                    
                    // Khi blur, t·ª± ƒë·ªông th√™m 0 n·∫øu ch·ªâ c√≥ 1 ch·ªØ s·ªë v√† validate
                    input.addEventListener('blur', function() {
                        const value = this.value.trim();
                        if (value.length === 1) {
                            const num = parseInt(value);
                            if (num >= 1 && num <= 9) {
                                this.value = '0' + value;
                            }
                        }
                        validate();
                    });
                    
                    input.addEventListener('keyup', validate);
                }

                // Validation cho nƒÉm (4 ch·ªØ s·ªë, t·ª´ 1900 ƒë·∫øn hi·ªán t·∫°i)
                function validateYear(input) {
                    function validate() {
                        const value = input.value.trim();
                        if (value === '') {
                            clearFieldError(input);
                            return;
                        }
                        
                        // Ki·ªÉm tra format 4 ch·ªØ s·ªë
                        if (value.length !== 4) {
                            showFieldError(input, 'NƒÉm ph·∫£i c√≥ 4 ch·ªØ s·ªë');
                            return;
                        }
                        
                        const yearValue = parseInt(value);
                        const currentYear = new Date().getFullYear();
                        
                        if (isNaN(yearValue) || yearValue < 1900 || yearValue > currentYear) {
                            showFieldError(input, `NƒÉm ph·∫£i t·ª´ 1900 ƒë·∫øn ${currentYear}`);
                        } else {
                            clearFieldError(input);
                            
                            // Re-validate ng√†y khi nƒÉm thay ƒë·ªïi (ƒë·ªÉ ki·ªÉm tra nƒÉm nhu·∫≠n)
                            const dayInput = document.getElementById('birth-day');
                            const monthInput = document.getElementById('birth-month');
                            if (dayInput && dayInput.value.length === 2 && monthInput && monthInput.value.length === 2) {
                                setTimeout(() => {
                                    validateDay(dayInput);
                                    validateFullDate();
                                }, 50);
                            }
                            
                            // Ki·ªÉm tra validation t·ªïng h·ª£p
                            setTimeout(validateFullDate, 100);
                        }
                    }

                    input.addEventListener('input', function(e) {
                        // Delay ƒë·ªÉ ƒë·∫£m b·∫£o IME ho√†n th√†nh x·ª≠ l√Ω
                        setTimeout(() => {
                            validate();
                        }, 10);
                    });
                    
                    input.addEventListener('blur', validate);
                    input.addEventListener('keyup', validate);
                }

                // Validation cho nƒÉm (1900 - nƒÉm hi·ªán t·∫°i)
                function validateYear(input) {
                    function validate() {
                        const value = parseInt(input.value);
                        const currentYear = new Date().getFullYear();
                        if (input.value === '') {
                            clearFieldError(input);
                            return;
                        }
                        if (isNaN(value) || value < 1900 || value > currentYear) {
                            showFieldError(input, `NƒÉm ph·∫£i t·ª´ 1900 ƒë·∫øn ${currentYear}`);
                        } else {
                            clearFieldError(input);
                            
                            // Re-validate ng√†y khi nƒÉm thay ƒë·ªïi (ƒë·ªÉ ki·ªÉm tra nƒÉm nhu·∫≠n)
                            const dayInput = document.getElementById('birth-day');
                            if (dayInput && dayInput.value.length === 2) {
                                setTimeout(() => {
                                    validateDay(dayInput);
                                    validateFullDate();
                                }, 50);
                            }
                            
                            // Ki·ªÉm tra validation t·ªïng h·ª£p
                            setTimeout(validateFullDate, 100);
                        }
                    }
                    
                    input.addEventListener('input', function(e) {
                        // Validate ngay khi nh·∫≠p
                        validate();
                        
                        // N·∫øu nh·∫≠p ƒë·ªß 4 k√Ω t·ª± nƒÉm h·ª£p l·ªá, chuy·ªÉn sang password
                        const value = parseInt(this.value);
                        const currentYear = new Date().getFullYear();
                        if (this.value.length === 4 && value >= 1900 && value <= currentYear) {
                            setTimeout(() => {
                                if (!input.parentElement.querySelector('.error-message:not([style*="display: none"])')) {
                                    // Chuy·ªÉn sang field password
                                    const passwordInput = document.getElementById('password');
                                    if (passwordInput) {
                                        passwordInput.focus();
                                    }
                                }
                            }, 100);
                        }
                    });
                    
                    input.addEventListener('blur', validate);
                    input.addEventListener('keyup', validate);
                }

                // Validation t·ªïng h·ª£p cho ng√†y h·ª£p l·ªá (format DD/MM/YYYY v·ªõi logic th√°ng ch√≠nh x√°c)
                function validateFullDate() {
                    const dayInput = document.getElementById('birth-day');
                    const monthInput = document.getElementById('birth-month');
                    const yearInput = document.getElementById('birth-year');

                    if (!dayInput || !monthInput || !yearInput) {
                        return true;
                    }

                    const dayValue = dayInput.value.trim();
                    const monthValue = monthInput.value.trim();
                    const yearValue = yearInput.value.trim();

                    // Ch·ªâ validate n·∫øu t·∫•t c·∫£ c√°c field c√≥ gi√° tr·ªã v√† ƒë√∫ng format
                    if (dayValue.length === 2 && monthValue.length === 2 && yearValue.length === 4) {
                        const day = parseInt(dayValue);
                        const month = parseInt(monthValue);
                        const year = parseInt(yearValue);
                        
                        if (!isNaN(day) && !isNaN(month) && !isNaN(year) &&
                            day >= 1 && day <= 31 && 
                            month >= 1 && month <= 12 && 
                            year >= 1900 && year <= new Date().getFullYear()) {
                            
                            // Ki·ªÉm tra s·ªë ng√†y t·ªëi ƒëa trong th√°ng
                            const maxDaysInMonth = getMaxDaysInMonth(month, year);
                            if (day > maxDaysInMonth) {
                                let errorMessage = '';
                                if (month === 2) {
                                    const isLeapYear = isLeapYearFunction(year);
                                    errorMessage = isLeapYear 
                                        ? 'Th√°ng 2 nƒÉm nhu·∫≠n ch·ªâ c√≥ 29 ng√†y'
                                        : 'Th√°ng 2 ch·ªâ c√≥ 28 ng√†y';
                                } else if ([4, 6, 9, 11].includes(month)) {
                                    errorMessage = `Th√°ng ${month.toString().padStart(2, '0')} ch·ªâ c√≥ 30 ng√†y`;
                                } else {
                                    errorMessage = `Ng√†y kh√¥ng h·ª£p l·ªá trong th√°ng ${month.toString().padStart(2, '0')}`;
                                }
                                showFieldError(dayInput, errorMessage);
                                return false;
                            }
                            
                            // Ki·ªÉm tra ng√†y c√≥ h·ª£p l·ªá b·∫±ng Date object (double check)
                            const date = new Date(year, month - 1, day);
                            if (date.getFullYear() !== year || date.getMonth() !== month - 1 || date.getDate() !== day) {
                                showFieldError(dayInput, 'Ng√†y kh√¥ng h·ª£p l·ªá');
                                return false;
                            } else {
                                // X√≥a l·ªói n·∫øu ng√†y h·ª£p l·ªá
                                const currentError = dayInput.parentElement.querySelector('.error-message');
                                if (currentError) {
                                    clearFieldError(dayInput);
                                }
                                return true;
                            }
                        }
                    }
                    return true;
                }

                // H√†m ki·ªÉm tra nƒÉm nhu·∫≠n
                function isLeapYearFunction(year) {
                    return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
                }

                // H√†m l·∫•y s·ªë ng√†y t·ªëi ƒëa trong th√°ng
                function getMaxDaysInMonth(month, year) {
                    const daysInMonth = {
                        1: 31,   // Th√°ng 1 - January
                        2: isLeapYearFunction(year) ? 29 : 28,  // Th√°ng 2 - February
                        3: 31,   // Th√°ng 3 - March
                        4: 30,   // Th√°ng 4 - April
                        5: 31,   // Th√°ng 5 - May
                        6: 30,   // Th√°ng 6 - June
                        7: 31,   // Th√°ng 7 - July
                        8: 31,   // Th√°ng 8 - August
                        9: 30,   // Th√°ng 9 - September
                        10: 31,  // Th√°ng 10 - October
                        11: 30,  // Th√°ng 11 - November
                        12: 31   // Th√°ng 12 - December
                    };
                    return daysInMonth[month] || 31;
                }

                // √Åp d·ª•ng validation
                allowOnlyNumbers(dayInput);
                allowOnlyNumbers(monthInput);
                allowOnlyNumbers(yearInput);

                validateDay(dayInput);
                validateMonth(monthInput);
                validateYear(yearInput);

                // Validation t·ªïng h·ª£p khi thay ƒë·ªïi b·∫•t k·ª≥ field n√†o
                [dayInput, monthInput, yearInput].forEach(input => {
                    input.addEventListener('blur', validateFullDate);
                });
            }

            // Setup date input validation
            setupDateInputValidation();
            
            // Setup email input - t·ª± ƒë·ªông chuy·ªÉn v·ªÅ ch·ªØ th∆∞·ªùng
            function setupEmailInput() {
                const emailInput = document.getElementById('email-address');
                if (emailInput) {
                    // T·ª± ƒë·ªông chuy·ªÉn v·ªÅ ch·ªØ th∆∞·ªùng khi nh·∫≠p
                    emailInput.addEventListener('input', function(e) {
                        const originalValue = this.value;
                        const lowercaseValue = originalValue.toLowerCase();
                        
                        if (originalValue !== lowercaseValue) {
                            // L∆∞u v·ªã tr√≠ con tr·ªè
                            const cursorPosition = this.selectionStart;
                            this.value = lowercaseValue;
                            // Kh√¥i ph·ª•c v·ªã tr√≠ con tr·ªè
                            this.selectionStart = cursorPosition;
                            this.selectionEnd = cursorPosition;
                        }
                    });
                    
                    // Chuy·ªÉn v·ªÅ ch·ªØ th∆∞·ªùng khi blur (r·ªùi kh·ªèi field)
                    emailInput.addEventListener('blur', function() {
                        this.value = this.value.toLowerCase();
                    });
                    
                    // Chuy·ªÉn v·ªÅ ch·ªØ th∆∞·ªùng khi paste
                    emailInput.addEventListener('paste', function(e) {
                        setTimeout(() => {
                            this.value = this.value.toLowerCase();
                        }, 10);
                    });
                }
            }
            
            // Setup email input normalization
            setupEmailInput();
            
            // --- Form validation and submission ---
            function validateForm() {
                const firstName = document.getElementById('first-name')?.value.trim() || '';
                const lastName = document.getElementById('last-name')?.value.trim() || '';
                const email = document.getElementById('email-address')?.value.trim().toLowerCase() || '';
                const day = document.getElementById('birth-day')?.value.trim() || '';
                const month = document.getElementById('birth-month')?.value.trim() || '';
                const year = document.getElementById('birth-year')?.value.trim() || '';
                const password = document.getElementById('password')?.value || '';
                const confirmPassword = document.getElementById('confirm-password')?.value || '';
                
                console.log('Validating form data:', { firstName, lastName, email, day, month, year });
                
                const errors = [];

                if (!firstName) errors.push('Vui l√≤ng nh·∫≠p t√™n');
                if (!lastName) errors.push('Vui l√≤ng nh·∫≠p h·ªç');
                if (!email) errors.push('Vui l√≤ng nh·∫≠p email');
                if (!day || !month || !year) errors.push('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß ng√†y sinh');
                
                // Ki·ªÉm tra format ng√†y sinh (DD/MM/YYYY)
                if (day && day.length !== 2) errors.push('Ng√†y ph·∫£i c√≥ 2 ch·ªØ s·ªë (01-31)');
                if (month && month.length !== 2) errors.push('Th√°ng ph·∫£i c√≥ 2 ch·ªØ s·ªë (01-12)');
                if (year && year.length !== 4) errors.push('NƒÉm ph·∫£i c√≥ 4 ch·ªØ s·ªë');
                
                if (!password) errors.push('Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u');
                if (password !== confirmPassword) errors.push('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp');
                if (password.length < 6) errors.push('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±');

                // Validate email format
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (email && !emailRegex.test(email)) {
                    errors.push('Email kh√¥ng h·ª£p l·ªá');
                }

                // Validate date
                if (day && month && year) {
                    const dayNum = parseInt(day);
                    const monthNum = parseInt(month);
                    const yearNum = parseInt(year);
                    
                    if (dayNum < 1 || dayNum > 31) errors.push('Ng√†y ph·∫£i t·ª´ 1 ƒë·∫øn 31');
                    if (monthNum < 1 || monthNum > 12) errors.push('Th√°ng ph·∫£i t·ª´ 1 ƒë·∫øn 12');
                    if (yearNum < 1900 || yearNum > new Date().getFullYear()) {
                        errors.push(`NƒÉm ph·∫£i t·ª´ 1900 ƒë·∫øn ${new Date().getFullYear()}`);
                    }
                    
                    // Validate actual date
                    const date = new Date(yearNum, monthNum - 1, dayNum);
                    if (date.getFullYear() !== yearNum || date.getMonth() !== monthNum - 1 || date.getDate() !== dayNum) {
                        errors.push('Ng√†y kh√¥ng h·ª£p l·ªá trong th√°ng n√†y');
                    }
                }

                // Check gender
                const genderElement = document.querySelector('input[name="gender"]:checked');
                if (!genderElement) {
                    errors.push('Vui l√≤ng ch·ªçn gi·ªõi t√≠nh');
                }

                return { isValid: errors.length === 0, errors };
            }

            // Handle form submission
            async function handleFormSubmit(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('üöÄ Form submission started');
                
                const validation = validateForm();
                if (!validation.isValid) {
                    console.error('‚ùå Form validation failed:', validation.errors);
                    if (typeof Swal !== 'undefined') {
                        Swal.fire({
                            icon: 'error',
                            title: 'L·ªói x√°c th·ª±c',
                            html: validation.errors.join('<br>'),
                            confirmButtonText: 'OK'
                        });
                    } else {
                        alert('L·ªói:\n' + validation.errors.join('\n'));
                    }
                    return;
                }

                const firstName = document.getElementById('first-name').value.trim();
                const lastName = document.getElementById('last-name').value.trim();
                const email = document.getElementById('email-address').value.trim().toLowerCase();
                const day = document.getElementById('birth-day').value.trim();
                const month = document.getElementById('birth-month').value.trim();
                const year = document.getElementById('birth-year').value.trim();
                const password = document.getElementById('password').value;
                
                console.log('üìù Form data extracted:', {
                    firstName,
                    lastName,
                    email,
                    day,
                    month,
                    year,
                    passwordLength: password.length
                });
                
                // Format birth date
                const birthDateFormatted = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;

                // Thu th·∫≠p gi·ªõi t√≠nh
                const genderElement = document.querySelector('input[name="gender"]:checked');
                const gender = genderElement ? genderElement.value : null;

                const formData = {
                    firstName,
                    lastName,
                    email,
                    password,
                    birthDate: birthDateFormatted,
                    gender,
                    profile: {
                        firstName,
                        lastName
                    }
                };

                console.log('üì§ Submitting form data:', formData);
                console.log('üîß Using axios:', typeof axios !== 'undefined' ? 'Native axios' : 'Fallback fetch');

                try {
                    // Hi·ªÉn th·ªã loading
                    const submitBtn = document.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<div class="loading-spinner"></div> ƒêang x·ª≠ l√Ω...';
                    submitBtn.disabled = true;

                    console.log('üåê Sending POST request to /api/auth/register...');
                    const response = await axios.post('/api/auth/register', formData);
                    
                    console.log('üìà Response status:', response.status);
                    console.log('üìã Response data:', response.data);

                    if (response.data.success) {
                        console.log('üéâ Registration successful!');
                        if (typeof Swal !== 'undefined') {
                            await Swal.fire({
                                icon: 'success',
                                title: 'ƒêƒÉng k√Ω th√†nh c√¥ng!',
                                text: 'Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang ƒëƒÉng nh·∫≠p...',
                                timer: 2000,
                                showConfirmButton: false
                            });
                        } else {
                            alert('ƒêƒÉng k√Ω th√†nh c√¥ng!');
                        }
                        
                        console.log('üöÄ Redirecting to /login...');
                        window.location.href = '/login';
                    } else {
                        console.error('‚ùå Registration failed:', response.data.message);
                        throw new Error(response.data.message || 'ƒêƒÉng k√Ω th·∫•t b·∫°i');
                    }
                } catch (error) {
                    console.error('üí• Registration error occurred:', error);
                    
                    // Kh√¥i ph·ª•c button tr∆∞·ªõc khi hi·ªÉn th·ªã l·ªói
                    const submitBtn = document.querySelector('button[type="submit"]');
                    const originalText = 'ƒêƒÉng K√Ω';
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    
                    let errorMessage = 'C√≥ l·ªói x·∫£y ra khi ƒëƒÉng k√Ω';
                    
                    if (error.response) {
                        // Server responded with error status
                        console.error('üö´ Server error response:', error.response.data);
                        console.error('üìä Error status:', error.response.status);
                        errorMessage = error.response.data?.message || `L·ªói server (${error.response.status})`;
                    } else if (error.message) {
                        // Network error or other issues
                        console.error('üåê Network/Client error:', error.message);
                        if (error.message.includes('404')) {
                            errorMessage = 'Kh√¥ng t√¨m th·∫•y API endpoint. Vui l√≤ng ki·ªÉm tra server.';
                        } else if (error.message.includes('Failed to fetch')) {
                            errorMessage = 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.';
                        } else {
                            errorMessage = error.message;
                        }
                    }

                    if (typeof Swal !== 'undefined') {
                        await Swal.fire({
                            icon: 'error',
                            title: 'ƒêƒÉng k√Ω th·∫•t b·∫°i',
                            text: errorMessage,
                            confirmButtonText: 'Th·ª≠ l·∫°i'
                        });
                    } else {
                        alert('ƒêƒÉng k√Ω th·∫•t b·∫°i: ' + errorMessage);
                    }
                }
            }

            // G·∫Øn event listener cho form
            const registerForm = document.getElementById('register-form');
            if (registerForm) {
                registerForm.addEventListener('submit', handleFormSubmit);
                console.log('‚úÖ Form event listener attached successfully');
            } else {
                console.error('‚ùå Register form not found! Check if form ID exists.');
            }

            console.log('üéâ Register page initialization completed!');

            window.addEventListener('click', (e) => {
                document.querySelectorAll('.form-group div.absolute').forEach(container => {
                    if (!container.parentElement.contains(e.target) && !container.classList.contains('hidden')) {
                        container.classList.add('hidden', 'opacity-0', 'scale-95');
                        const button = container.parentElement.querySelector('button');
                        const chevron = button.querySelector('svg');
                        button.classList.remove('focused');
                        if (chevron) chevron.style.transform = 'rotate(0deg)';
                    }
                });
            });
        }
    </script>
</body>
</html>
